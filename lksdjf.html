<script>
  function waitForElement(
    selector,
    root = document,
    callback,
    intervalTime = 500,
    maxAttempts = 20,
  ) {
    let attempts = 0;
    const interval = setInterval(() => {
      const element = root.querySelector(selector);
      if (element) {
        clearInterval(interval);
        callback(element);
      }
      if (++attempts >= maxAttempts) {
        clearInterval(interval);
        console.warn(`Елемент ${selector} не знайдено.`);
      }
    }, intervalTime);
  }

  function translateUpCartHeader() {
    console.log('Скрипт ініціалізовано');

    const upCartElement = document.getElementById('upCart');
    if (!upCartElement) {
      console.warn('UpCart не знайдено');
      return;
    }

    function findAndTranslateHeader() {
      const shadowRoot = upCartElement.shadowRoot;
      if (!shadowRoot) {
        console.warn('ShadowRoot не знайдено');
        return;
      }

      waitForElement('.upcart-header-text', shadowRoot, (header) => {
        console.log('Знайдено header:', header);

        const lang = document.documentElement.lang;
        if (lang === 'uk') {
          header.textContent = 'Ваш кошик';
        } else if (lang === 'ru') {
          header.textContent = 'Ваша корзина';
        }
      });
    }

    if (upCartElement.shadowRoot) {
      findAndTranslateHeader();
    } else {
      // Спостерігаємо за появою shadowRoot
      const observer = new MutationObserver(() => {
        if (upCartElement.shadowRoot) {
          observer.disconnect();
          findAndTranslateHeader();
        }
      });

      observer.observe(upCartElement, {childList: true, subtree: true});
    }
  }

  // Виконуємо після завантаження сторінки
  translateUpCartHeader();
</script>
